function debounce(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}jQuery(document).ready(function(a){function b(){console.log("Drawing Charts");for(var a in window.theCharts){var b=[["Assessments","Average"]];window.theCharts[a].data.forEach(function(a){"use strict";b.push([a.assessment.split(" ")[0],a.average])});var c=google.visualization.arrayToDataTable(b),d=new google.visualization.DataView(c);d.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"number",role:"annotation"}]);var e={title:window.theCharts[a].category,hAxis:{title:"Assessments"},vAxis:{minValue:0,maxValue:5},legend:"none"},f=document.getElementsByClassName(window.theCharts[a].location);[].forEach.call(f,function(a){"use strict";var b=new google.visualization.ColumnChart(a);b.draw(c,e)})}}var c=a("#bloom");a("#pref_submit").click(function(b){"use strict";b.preventDefault();var c=a("#preferences").find(":radio:checked").val();c&&a.post(POM_BLOOM.ajax_url,{user:POM_BLOOM.current_user,preference:c,route:"preferences",action:"pom_bloom"},function(a){a&&a.success&&(window.location.search="page=overview")},"json"),console.log(c)}),a("#pref_cancel").click(function(a){"use strict";a.preventDefault(),window.location.search="page=overview"}),a("form.assessment_create").submit(function(b){"use strict";b.preventDefault();var d=a(this).serializeArray(),e=jQuery("input:radio",c),f=[],g=[];e.each(function(a,b){-1===f.indexOf(b.name)&&(f.push(b.name),_.find(d,function(a){return a.name===b.name})||g.push(b.name))}),a(".qgroup").each(function(b,c){-1===g.indexOf(c.id.replace("_group",""))?a(c).removeClass("missing"):a(c).addClass("missing")}),g.length>0?a("#missing_warning").text("It looks like you're missing "+g.length+" answers. Please check your answers try submitting again.").show():(a("#missing_warning").hide(),a.post(POM_BLOOM.ajax_url,{user:POM_BLOOM.current_user,assessment:d,route:"assessments",action:"pom_bloom"},function(a){a&&a.success&&(window.location.search="page=overview")},"json"))}),window.fillform=function(a){jQuery('input[type="radio"]').each(function(b,c){0>a?c.checked=!1:parseInt(c.value)===parseInt(a)&&(c.checked=!0)})},a("form.goals_set",c).find(".subcategories select").change(function(){"use strict";var b=a(this),c=a("option:selected",b).val();a.post(POM_BLOOM.ajax_url,{user:POM_BLOOM.current_user,category_id:c,route:"goal_suggestions",action:"pom_bloom"},function(c){if(c&&c.success){console.log(c);var d,e=b.parents("fieldset").find(".recommendations .results"),f=a("<ul />");if(!c.goals.length)return void e.text("No suggestions available for this category.");a.each(c.goals,function(b,c){d=a("<li />").append(a("<div></div>",{"class":"clickable","data-id":c.id,"data-per_week":c.per_week,text:c.suggestion,click:function(){var b=a(this),c=b.parents("fieldset"),d=c.find(".goal textarea"),e=c.find(".per_week select"),f=c.find('.goal input[name^="suggestions"]');b.addClass("selected").delay(2e3).queue(function(a){b.removeClass("selected"),a()}),d.val(b.text()),f.val(b.data("id")),e.val(b.data("per_week")),a("html, body").animate({scrollTop:d.offset().top-200},2e3)}})),d.appendTo(f)}),e.html(f),console.log(e)}},"json")}),a("form.goals_set",c).submit(function(b){b.preventDefault(),console.log(a(this).serialize()),a.post(POM_BLOOM.ajax_url,{user:POM_BLOOM.current_user,data:a(this).serialize(),route:"add_goals",action:"pom_bloom"},function(a){a&&a.success&&(window.location.search="page=overview")},"json")}),window.location.search.indexOf("page=goals.set")&&window.google&&(google=window.google,google.load("visualization","1.0",{callback:function(){console.log("loading")},packages:["corechart"]}),google.setOnLoadCallback(b)),a("#goals_update .clickable",c).click(function(){"use strict";var b=a(this),c=b.hasClass("set"),d=b.siblings(".done"),e=d.data("per_week"),f=0;a.post(POM_BLOOM.ajax_url,{user:POM_BLOOM.current_user,set:!c,goal:b.data("goal"),day:b.data("day"),route:"update_goals",action:"pom_bloom"},function(a){a&&a.success&&(b.removeClass("set"),d.removeClass("set"),f=b.siblings(".set").length,a.set&&(b.addClass("set"),f+=1),f>=e&&d.addClass("set"))},"json")});var d=a("#goals_update .serendipity",c);d.on("change keyup paste",debounce(function(){"use strict";var b=a(this),c=b.parent().siblings(".done");c.removeClass("set"),""!==a.trim(b.val())&&c.addClass("set"),a.post(POM_BLOOM.ajax_url,{user:POM_BLOOM.current_user,serendipity:b.val(),id:b.data("id"),route:"update_serendipity",action:"pom_bloom"},function(){},"json")},200)),a("#goals_update").find("tr.goal th div").click(function(){"use strict";var b=a(this),c=b.triggerHandler("isTruncated");c?(this.style.height="1000px",b.trigger("update"),this.style.height="auto"):this.style.height="",b.trigger("update")}).dotdotdot({callback:function(a,b){"use strict";a&&(this.title=b[0].data)}}).trigger("update.dot")});